{
 "cells": [
  {
   "cell_type": "code",
   "execution_count": 1,
   "id": "b93d230a",
   "metadata": {
    "execution": {
     "iopub.execute_input": "2024-08-05T01:05:00.139946Z",
     "iopub.status.busy": "2024-08-05T01:05:00.139644Z",
     "iopub.status.idle": "2024-08-05T01:05:18.056806Z",
     "shell.execute_reply": "2024-08-05T01:05:18.056053Z"
    },
    "papermill": {
     "duration": 17.927077,
     "end_time": "2024-08-05T01:05:18.059148",
     "exception": false,
     "start_time": "2024-08-05T01:05:00.132071",
     "status": "completed"
    },
    "tags": []
   },
   "outputs": [
    {
     "name": "stderr",
     "output_type": "stream",
     "text": [
      "WARNING: Logging before InitGoogle() is written to STDERR\n",
      "E0000 00:00:1722819907.524568      77 common_lib.cc:798] Could not set metric server port: INVALID_ARGUMENT: Could not find SliceBuilder port 8471 in any of the 0 ports provided in `tpu_process_addresses`=\"local\"\n",
      "=== Source Location Trace: ===\n",
      "learning/45eac/tfrc/runtime/common_lib.cc:479\n",
      "D0805 01:05:07.532618608      77 config.cc:196]                        gRPC EXPERIMENT call_status_override_on_cancellation   OFF (default:OFF)\n",
      "D0805 01:05:07.532633316      77 config.cc:196]                        gRPC EXPERIMENT call_v3                                OFF (default:OFF)\n",
      "D0805 01:05:07.532636538      77 config.cc:196]                        gRPC EXPERIMENT canary_client_privacy                  ON  (default:ON)\n",
      "D0805 01:05:07.532638902      77 config.cc:196]                        gRPC EXPERIMENT capture_base_context                   ON  (default:ON)\n",
      "D0805 01:05:07.532641258      77 config.cc:196]                        gRPC EXPERIMENT client_idleness                        ON  (default:ON)\n",
      "D0805 01:05:07.532643539      77 config.cc:196]                        gRPC EXPERIMENT client_privacy                         ON  (default:ON)\n",
      "D0805 01:05:07.532645715      77 config.cc:196]                        gRPC EXPERIMENT dapper_request_wire_size               OFF (default:OFF)\n",
      "D0805 01:05:07.532647875      77 config.cc:196]                        gRPC EXPERIMENT empty_experiment                       OFF (default:OFF)\n",
      "D0805 01:05:07.532649976      77 config.cc:196]                        gRPC EXPERIMENT event_engine_client                    OFF (default:OFF)\n",
      "D0805 01:05:07.532652070      77 config.cc:196]                        gRPC EXPERIMENT event_engine_dns                       ON  (default:ON)\n",
      "D0805 01:05:07.532654168      77 config.cc:196]                        gRPC EXPERIMENT event_engine_listener                  ON  (default:ON)\n",
      "D0805 01:05:07.532656292      77 config.cc:196]                        gRPC EXPERIMENT free_large_allocator                   OFF (default:OFF)\n",
      "D0805 01:05:07.532658387      77 config.cc:196]                        gRPC EXPERIMENT google_no_envelope_resolver            OFF (default:OFF)\n",
      "D0805 01:05:07.532660482      77 config.cc:196]                        gRPC EXPERIMENT http2_stats_fix                        OFF (default:OFF)\n",
      "D0805 01:05:07.532662578      77 config.cc:196]                        gRPC EXPERIMENT keepalive_fix                          OFF (default:OFF)\n",
      "D0805 01:05:07.532664727      77 config.cc:196]                        gRPC EXPERIMENT keepalive_server_fix                   ON  (default:ON)\n",
      "D0805 01:05:07.532666985      77 config.cc:196]                        gRPC EXPERIMENT loas_do_not_prefer_rekey_next_protocol OFF (default:OFF)\n",
      "D0805 01:05:07.532669142      77 config.cc:196]                        gRPC EXPERIMENT loas_prod_to_cloud_prefer_pfs_ciphers  OFF (default:OFF)\n",
      "D0805 01:05:07.532671266      77 config.cc:196]                        gRPC EXPERIMENT monitoring_experiment                  ON  (default:ON)\n",
      "D0805 01:05:07.532673408      77 config.cc:196]                        gRPC EXPERIMENT multiping                              OFF (default:OFF)\n",
      "D0805 01:05:07.532675505      77 config.cc:196]                        gRPC EXPERIMENT peer_state_based_framing               OFF (default:OFF)\n",
      "D0805 01:05:07.532677627      77 config.cc:196]                        gRPC EXPERIMENT pending_queue_cap                      ON  (default:ON)\n",
      "D0805 01:05:07.532679814      77 config.cc:196]                        gRPC EXPERIMENT pick_first_happy_eyeballs              ON  (default:ON)\n",
      "D0805 01:05:07.532681958      77 config.cc:196]                        gRPC EXPERIMENT promise_based_client_call              OFF (default:OFF)\n",
      "D0805 01:05:07.532684008      77 config.cc:196]                        gRPC EXPERIMENT promise_based_inproc_transport         OFF (default:OFF)\n",
      "D0805 01:05:07.532686073      77 config.cc:196]                        gRPC EXPERIMENT promise_based_server_call              OFF (default:OFF)\n",
      "D0805 01:05:07.532688244      77 config.cc:196]                        gRPC EXPERIMENT registered_method_lookup_in_transport  ON  (default:ON)\n",
      "D0805 01:05:07.532690388      77 config.cc:196]                        gRPC EXPERIMENT rfc_max_concurrent_streams             ON  (default:ON)\n",
      "D0805 01:05:07.532692607      77 config.cc:196]                        gRPC EXPERIMENT round_robin_delegate_to_pick_first     ON  (default:ON)\n",
      "D0805 01:05:07.532696136      77 config.cc:196]                        gRPC EXPERIMENT rstpit                                 OFF (default:OFF)\n",
      "D0805 01:05:07.532698401      77 config.cc:196]                        gRPC EXPERIMENT schedule_cancellation_over_write       OFF (default:OFF)\n",
      "D0805 01:05:07.532700705      77 config.cc:196]                        gRPC EXPERIMENT server_privacy                         ON  (default:ON)\n",
      "D0805 01:05:07.532703192      77 config.cc:196]                        gRPC EXPERIMENT tcp_frame_size_tuning                  OFF (default:OFF)\n",
      "D0805 01:05:07.532705414      77 config.cc:196]                        gRPC EXPERIMENT tcp_rcv_lowat                          OFF (default:OFF)\n",
      "D0805 01:05:07.532707526      77 config.cc:196]                        gRPC EXPERIMENT trace_record_callops                   OFF (default:OFF)\n",
      "D0805 01:05:07.532709643      77 config.cc:196]                        gRPC EXPERIMENT unconstrained_max_quota_buffer_size    OFF (default:OFF)\n",
      "D0805 01:05:07.532711712      77 config.cc:196]                        gRPC EXPERIMENT v3_backend_metric_filter               OFF (default:OFF)\n",
      "D0805 01:05:07.532713809      77 config.cc:196]                        gRPC EXPERIMENT v3_channel_idle_filters                ON  (default:ON)\n",
      "D0805 01:05:07.532715969      77 config.cc:196]                        gRPC EXPERIMENT v3_compression_filter                  ON  (default:ON)\n",
      "D0805 01:05:07.532718108      77 config.cc:196]                        gRPC EXPERIMENT v3_server_auth_filter                  OFF (default:OFF)\n",
      "D0805 01:05:07.532720196      77 config.cc:196]                        gRPC EXPERIMENT work_serializer_clears_time_cache      OFF (default:OFF)\n",
      "D0805 01:05:07.532722270      77 config.cc:196]                        gRPC EXPERIMENT work_serializer_dispatch               OFF (default:OFF)\n",
      "D0805 01:05:07.532724399      77 config.cc:196]                        gRPC EXPERIMENT write_size_cap                         ON  (default:ON)\n",
      "D0805 01:05:07.532726585      77 config.cc:196]                        gRPC EXPERIMENT write_size_policy                      ON  (default:ON)\n",
      "D0805 01:05:07.532728771      77 config.cc:196]                        gRPC EXPERIMENT wrr_delegate_to_pick_first             ON  (default:ON)\n",
      "I0805 01:05:07.532886920      77 ev_epoll1_linux.cc:123]               grpc epoll fd: 56\n",
      "D0805 01:05:07.532898744      77 ev_posix.cc:113]                      Using polling engine: epoll1\n",
      "D0805 01:05:07.545389395      77 lb_policy_registry.cc:46]             registering LB policy factory for \"priority_experimental\"\n",
      "D0805 01:05:07.545399917      77 lb_policy_registry.cc:46]             registering LB policy factory for \"outlier_detection_experimental\"\n",
      "D0805 01:05:07.545408264      77 lb_policy_registry.cc:46]             registering LB policy factory for \"weighted_target_experimental\"\n",
      "D0805 01:05:07.545411600      77 lb_policy_registry.cc:46]             registering LB policy factory for \"pick_first\"\n",
      "D0805 01:05:07.545414859      77 lb_policy_registry.cc:46]             registering LB policy factory for \"round_robin\"\n",
      "D0805 01:05:07.545417920      77 lb_policy_registry.cc:46]             registering LB policy factory for \"weighted_round_robin\"\n",
      "D0805 01:05:07.545444402      77 lb_policy_registry.cc:46]             registering LB policy factory for \"grpclb\"\n",
      "D0805 01:05:07.545459547      77 dns_resolver_plugin.cc:43]            Using EventEngine dns resolver\n",
      "D0805 01:05:07.545476285      77 lb_policy_registry.cc:46]             registering LB policy factory for \"rls_experimental\"\n",
      "D0805 01:05:07.545498230      77 lb_policy_registry.cc:46]             registering LB policy factory for \"xds_cluster_manager_experimental\"\n",
      "D0805 01:05:07.545505937      77 lb_policy_registry.cc:46]             registering LB policy factory for \"xds_cluster_impl_experimental\"\n",
      "D0805 01:05:07.545509317      77 lb_policy_registry.cc:46]             registering LB policy factory for \"cds_experimental\"\n",
      "D0805 01:05:07.545513503      77 lb_policy_registry.cc:46]             registering LB policy factory for \"xds_override_host_experimental\"\n",
      "D0805 01:05:07.545520040      77 lb_policy_registry.cc:46]             registering LB policy factory for \"xds_wrr_locality_experimental\"\n",
      "D0805 01:05:07.545535505      77 lb_policy_registry.cc:46]             registering LB policy factory for \"ring_hash_experimental\"\n",
      "D0805 01:05:07.545538935      77 certificate_provider_registry.cc:33]  registering certificate provider factory for \"file_watcher\"\n",
      "D0805 01:05:07.545569295      77 channel_init.cc:157]                  Filter server-auth not registered, but is referenced in the after clause of grpc-server-authz when building channel stack SERVER_CHANNEL\n",
      "I0805 01:05:07.547153934      77 ev_epoll1_linux.cc:359]               grpc epoll fd: 58\n",
      "I0805 01:05:07.548393571      77 tcp_socket_utils.cc:689]              Disabling AF_INET6 sockets because ::1 is not available.\n",
      "I0805 01:05:07.552962103     174 socket_utils_common_posix.cc:452]     Disabling AF_INET6 sockets because ::1 is not available.\n",
      "I0805 01:05:07.553010503     174 socket_utils_common_posix.cc:379]     TCP_USER_TIMEOUT is available. TCP_USER_TIMEOUT will be used thereafter\n",
      "E0805 01:05:07.559413382      77 oauth2_credentials.cc:238]            oauth_fetch: UNKNOWN:C-ares status is not ARES_SUCCESS qtype=A name=metadata.google.internal. is_balancer=0: Domain name not found {grpc_status:2, created_time:\"2024-08-05T01:05:07.55939915+00:00\"}\n"
     ]
    },
    {
     "name": "stderr",
     "output_type": "stream",
     "text": [
      "/usr/local/lib/python3.10/site-packages/tqdm/auto.py:21: TqdmWarning: IProgress not found. Please update jupyter and ipywidgets. See https://ipywidgets.readthedocs.io/en/stable/user_install.html\n",
      "  from .autonotebook import tqdm as notebook_tqdm\n"
     ]
    }
   ],
   "source": [
    "import pandas as pd\n",
    "import keras\n",
    "import keras_nlp\n",
    "import tensorflow as tf\n",
    "from sklearn.model_selection import train_test_split\n",
    "from matplotlib import pyplot as plt"
   ]
  },
  {
   "cell_type": "markdown",
   "id": "2a8bbb20",
   "metadata": {
    "papermill": {
     "duration": 0.004288,
     "end_time": "2024-08-05T01:05:18.068081",
     "exception": false,
     "start_time": "2024-08-05T01:05:18.063793",
     "status": "completed"
    },
    "tags": []
   },
   "source": [
    "# Load Train Data"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 2,
   "id": "c44a026c",
   "metadata": {
    "execution": {
     "iopub.execute_input": "2024-08-05T01:05:18.078170Z",
     "iopub.status.busy": "2024-08-05T01:05:18.077726Z",
     "iopub.status.idle": "2024-08-05T01:05:25.494654Z",
     "shell.execute_reply": "2024-08-05T01:05:25.493952Z"
    },
    "papermill": {
     "duration": 7.423947,
     "end_time": "2024-08-05T01:05:25.496419",
     "exception": false,
     "start_time": "2024-08-05T01:05:18.072472",
     "status": "completed"
    },
    "tags": []
   },
   "outputs": [
    {
     "data": {
      "text/html": [
       "<div>\n",
       "<style scoped>\n",
       "    .dataframe tbody tr th:only-of-type {\n",
       "        vertical-align: middle;\n",
       "    }\n",
       "\n",
       "    .dataframe tbody tr th {\n",
       "        vertical-align: top;\n",
       "    }\n",
       "\n",
       "    .dataframe thead th {\n",
       "        text-align: right;\n",
       "    }\n",
       "</style>\n",
       "<table border=\"1\" class=\"dataframe\">\n",
       "  <thead>\n",
       "    <tr style=\"text-align: right;\">\n",
       "      <th></th>\n",
       "      <th>id</th>\n",
       "      <th>model_a</th>\n",
       "      <th>model_b</th>\n",
       "      <th>prompt</th>\n",
       "      <th>response_a</th>\n",
       "      <th>response_b</th>\n",
       "      <th>winner_model_a</th>\n",
       "      <th>winner_model_b</th>\n",
       "      <th>winner_tie</th>\n",
       "    </tr>\n",
       "  </thead>\n",
       "  <tbody>\n",
       "    <tr>\n",
       "      <th>0</th>\n",
       "      <td>30192</td>\n",
       "      <td>gpt-4-1106-preview</td>\n",
       "      <td>gpt-4-0613</td>\n",
       "      <td>Is it morally right to try to have a certain p...</td>\n",
       "      <td>The question of whether it is morally right to...</td>\n",
       "      <td>As an AI, I don't have personal beliefs or opi...</td>\n",
       "      <td>1</td>\n",
       "      <td>0</td>\n",
       "      <td>0</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>1</th>\n",
       "      <td>53567</td>\n",
       "      <td>koala-13b</td>\n",
       "      <td>gpt-4-0613</td>\n",
       "      <td>What is the difference between marriage licens...</td>\n",
       "      <td>A marriage license is a legal document that al...</td>\n",
       "      <td>A marriage license and a marriage certificate ...</td>\n",
       "      <td>0</td>\n",
       "      <td>1</td>\n",
       "      <td>0</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>2</th>\n",
       "      <td>65089</td>\n",
       "      <td>gpt-3.5-turbo-0613</td>\n",
       "      <td>mistral-medium</td>\n",
       "      <td>explain function calling. how would you call a...</td>\n",
       "      <td>Function calling is the process of invoking or...</td>\n",
       "      <td>Function calling is the process of invoking a ...</td>\n",
       "      <td>0</td>\n",
       "      <td>0</td>\n",
       "      <td>1</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>3</th>\n",
       "      <td>96401</td>\n",
       "      <td>llama-2-13b-chat</td>\n",
       "      <td>mistral-7b-instruct</td>\n",
       "      <td>How can I create a test set for a very rare ca...</td>\n",
       "      <td>Creating a test set for a very rare category c...</td>\n",
       "      <td>When building a classifier for a very rare cat...</td>\n",
       "      <td>1</td>\n",
       "      <td>0</td>\n",
       "      <td>0</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>4</th>\n",
       "      <td>198779</td>\n",
       "      <td>koala-13b</td>\n",
       "      <td>gpt-3.5-turbo-0314</td>\n",
       "      <td>What is the best way to travel from Tel-Aviv t...</td>\n",
       "      <td>The best way to travel from Tel Aviv to Jerusa...</td>\n",
       "      <td>The best way to travel from Tel-Aviv to Jerusa...</td>\n",
       "      <td>0</td>\n",
       "      <td>1</td>\n",
       "      <td>0</td>\n",
       "    </tr>\n",
       "  </tbody>\n",
       "</table>\n",
       "</div>"
      ],
      "text/plain": [
       "       id             model_a              model_b  \\\n",
       "0   30192  gpt-4-1106-preview           gpt-4-0613   \n",
       "1   53567           koala-13b           gpt-4-0613   \n",
       "2   65089  gpt-3.5-turbo-0613       mistral-medium   \n",
       "3   96401    llama-2-13b-chat  mistral-7b-instruct   \n",
       "4  198779           koala-13b   gpt-3.5-turbo-0314   \n",
       "\n",
       "                                              prompt  \\\n",
       "0  Is it morally right to try to have a certain p...   \n",
       "1  What is the difference between marriage licens...   \n",
       "2  explain function calling. how would you call a...   \n",
       "3  How can I create a test set for a very rare ca...   \n",
       "4  What is the best way to travel from Tel-Aviv t...   \n",
       "\n",
       "                                          response_a  \\\n",
       "0  The question of whether it is morally right to...   \n",
       "1  A marriage license is a legal document that al...   \n",
       "2  Function calling is the process of invoking or...   \n",
       "3  Creating a test set for a very rare category c...   \n",
       "4  The best way to travel from Tel Aviv to Jerusa...   \n",
       "\n",
       "                                          response_b  winner_model_a  \\\n",
       "0  As an AI, I don't have personal beliefs or opi...               1   \n",
       "1  A marriage license and a marriage certificate ...               0   \n",
       "2  Function calling is the process of invoking a ...               0   \n",
       "3  When building a classifier for a very rare cat...               1   \n",
       "4  The best way to travel from Tel-Aviv to Jerusa...               0   \n",
       "\n",
       "   winner_model_b  winner_tie  \n",
       "0               0           0  \n",
       "1               1           0  \n",
       "2               0           1  \n",
       "3               0           0  \n",
       "4               1           0  "
      ]
     },
     "execution_count": 2,
     "metadata": {},
     "output_type": "execute_result"
    }
   ],
   "source": [
    "# Load Kaggle Base Folder\n",
    "base_dir = '/kaggle/input/lmsys-chatbot-arena/'\n",
    "\n",
    "# Load Train Data\n",
    "df = pd.read_csv(base_dir + 'train.csv')\n",
    "\n",
    "# Parse String and Ensure all text data is encoded to UTF-8\n",
    "for col in [i for i in df.columns if i in ['prompt', 'response_a', 'response_b']]:\n",
    "    df[col] = df[col].map(lambda x: eval(x.replace(\"null\", \"''\"))[0])\n",
    "    df[col] = df[col].apply(lambda x: str(x).encode('utf-8', errors='ignore').decode('utf-8'))\n",
    "\n",
    "# Show Sample\n",
    "df.head()"
   ]
  },
  {
   "cell_type": "markdown",
   "id": "a362365b",
   "metadata": {
    "papermill": {
     "duration": 0.004408,
     "end_time": "2024-08-05T01:05:25.505728",
     "exception": false,
     "start_time": "2024-08-05T01:05:25.501320",
     "status": "completed"
    },
    "tags": []
   },
   "source": [
    "# Create Label"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 3,
   "id": "163a3721",
   "metadata": {
    "execution": {
     "iopub.execute_input": "2024-08-05T01:05:25.516001Z",
     "iopub.status.busy": "2024-08-05T01:05:25.515753Z",
     "iopub.status.idle": "2024-08-05T01:05:25.531770Z",
     "shell.execute_reply": "2024-08-05T01:05:25.531137Z"
    },
    "papermill": {
     "duration": 0.023377,
     "end_time": "2024-08-05T01:05:25.533531",
     "exception": false,
     "start_time": "2024-08-05T01:05:25.510154",
     "status": "completed"
    },
    "tags": []
   },
   "outputs": [],
   "source": [
    "# Create label dictionary for mapping\n",
    "label_map = {'winner_model_a': 0, 'winner_model_b': 1, 'winner_tie': 2}\n",
    "\n",
    "# Map column into label\n",
    "df['label'] = df[['winner_model_a', 'winner_model_b', 'winner_tie']].idxmax(axis=1).map(label_map)"
   ]
  },
  {
   "cell_type": "markdown",
   "id": "23f7a83b",
   "metadata": {
    "papermill": {
     "duration": 0.004723,
     "end_time": "2024-08-05T01:05:25.542498",
     "exception": false,
     "start_time": "2024-08-05T01:05:25.537775",
     "status": "completed"
    },
    "tags": []
   },
   "source": [
    "# Tokenizer & Preprocessor"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 4,
   "id": "feaefa74",
   "metadata": {
    "execution": {
     "iopub.execute_input": "2024-08-05T01:05:25.554423Z",
     "iopub.status.busy": "2024-08-05T01:05:25.554122Z",
     "iopub.status.idle": "2024-08-05T01:05:35.739830Z",
     "shell.execute_reply": "2024-08-05T01:05:35.738785Z"
    },
    "papermill": {
     "duration": 10.194745,
     "end_time": "2024-08-05T01:05:35.741797",
     "exception": false,
     "start_time": "2024-08-05T01:05:25.547052",
     "status": "completed"
    },
    "tags": []
   },
   "outputs": [
    {
     "name": "stdout",
     "output_type": "stream",
     "text": [
      "Attaching 'model.safetensors' from model 'keras/bert/keras/bert_small_en_uncased/2' to your Kaggle notebook...\n"
     ]
    },
    {
     "name": "stdout",
     "output_type": "stream",
     "text": [
      "Attaching 'model.safetensors.index.json' from model 'keras/bert/keras/bert_small_en_uncased/2' to your Kaggle notebook...\n"
     ]
    },
    {
     "name": "stdout",
     "output_type": "stream",
     "text": [
      "Attaching 'metadata.json' from model 'keras/bert/keras/bert_small_en_uncased/2' to your Kaggle notebook...\n"
     ]
    },
    {
     "name": "stdout",
     "output_type": "stream",
     "text": [
      "Attaching 'metadata.json' from model 'keras/bert/keras/bert_small_en_uncased/2' to your Kaggle notebook...\n"
     ]
    },
    {
     "name": "stdout",
     "output_type": "stream",
     "text": [
      "Attaching 'tokenizer.json' from model 'keras/bert/keras/bert_small_en_uncased/2' to your Kaggle notebook...\n"
     ]
    },
    {
     "name": "stdout",
     "output_type": "stream",
     "text": [
      "Attaching 'tokenizer.json' from model 'keras/bert/keras/bert_small_en_uncased/2' to your Kaggle notebook...\n"
     ]
    },
    {
     "name": "stdout",
     "output_type": "stream",
     "text": [
      "Attaching 'assets/tokenizer/vocabulary.txt' from model 'keras/bert/keras/bert_small_en_uncased/2' to your Kaggle notebook...\n"
     ]
    },
    {
     "name": "stderr",
     "output_type": "stream",
     "text": [
      "WARNING: All log messages before absl::InitializeLog() is called are written to STDERR\n",
      "I0000 00:00:1722819935.660768      77 service.cc:145] XLA service 0x56751a2978d0 initialized for platform TPU (this does not guarantee that XLA will be used). Devices:\n",
      "I0000 00:00:1722819935.660822      77 service.cc:153]   StreamExecutor device (0): TPU, 2a886c8\n",
      "I0000 00:00:1722819935.660827      77 service.cc:153]   StreamExecutor device (1): TPU, 2a886c8\n",
      "I0000 00:00:1722819935.660830      77 service.cc:153]   StreamExecutor device (2): TPU, 2a886c8\n",
      "I0000 00:00:1722819935.660833      77 service.cc:153]   StreamExecutor device (3): TPU, 2a886c8\n",
      "I0000 00:00:1722819935.660836      77 service.cc:153]   StreamExecutor device (4): TPU, 2a886c8\n",
      "I0000 00:00:1722819935.660839      77 service.cc:153]   StreamExecutor device (5): TPU, 2a886c8\n",
      "I0000 00:00:1722819935.660842      77 service.cc:153]   StreamExecutor device (6): TPU, 2a886c8\n",
      "I0000 00:00:1722819935.660844      77 service.cc:153]   StreamExecutor device (7): TPU, 2a886c8\n"
     ]
    }
   ],
   "source": [
    "tokenizer = keras_nlp.models.BertTokenizer.from_preset(\n",
    "    \"bert_small_en_uncased\",\n",
    ")\n",
    "\n",
    "preprocessor = keras_nlp.models.BertPreprocessor(\n",
    "    tokenizer=tokenizer,\n",
    "    sequence_length=512\n",
    ")\n",
    "\n",
    "# Update preprocess_fn to handle multiple inputs and return additional features\n",
    "def preprocess_fn(prompt, response_a, response_b, label=None):\n",
    "    prompt = preprocessor(prompt)\n",
    "    response_a = preprocessor(response_a)\n",
    "    response_b = preprocessor(response_b)\n",
    "    inputs = {\n",
    "        'prompt_input': prompt['token_ids'],\n",
    "        'prompt_segment_ids': prompt['segment_ids'],\n",
    "        'prompt_padding_mask': prompt['padding_mask'],\n",
    "        'response_a_input': response_a['token_ids'],\n",
    "        'response_a_segment_ids': response_a['segment_ids'],\n",
    "        'response_a_padding_mask': response_a['padding_mask'],\n",
    "        'response_b_input': response_b['token_ids'],\n",
    "        'response_b_segment_ids': response_b['segment_ids'],\n",
    "        'response_b_padding_mask': response_b['padding_mask'],\n",
    "    }\n",
    "    return (inputs, label) if label is not None else inputs\n"
   ]
  },
  {
   "cell_type": "markdown",
   "id": "a8946686",
   "metadata": {
    "papermill": {
     "duration": 0.005129,
     "end_time": "2024-08-05T01:05:35.752222",
     "exception": false,
     "start_time": "2024-08-05T01:05:35.747093",
     "status": "completed"
    },
    "tags": []
   },
   "source": [
    "# Build Dataset"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 5,
   "id": "def4aa8f",
   "metadata": {
    "execution": {
     "iopub.execute_input": "2024-08-05T01:05:35.763376Z",
     "iopub.status.busy": "2024-08-05T01:05:35.763004Z",
     "iopub.status.idle": "2024-08-05T01:05:35.769508Z",
     "shell.execute_reply": "2024-08-05T01:05:35.768781Z"
    },
    "papermill": {
     "duration": 0.01447,
     "end_time": "2024-08-05T01:05:35.771335",
     "exception": false,
     "start_time": "2024-08-05T01:05:35.756865",
     "status": "completed"
    },
    "tags": []
   },
   "outputs": [],
   "source": [
    "# Update build_dataset function\n",
    "def build_dataset(prompts, responses_a, responses_b, labels=None, batch_size=16, shuffle=True):\n",
    "    slices = (prompts, responses_a, responses_b, keras.utils.to_categorical(labels, num_classes=3)) if labels is not None else (prompts, responses_a, responses_b)\n",
    "    ds = tf.data.Dataset.from_tensor_slices(slices)\n",
    "    ds = ds.map(preprocess_fn, num_parallel_calls=tf.data.AUTOTUNE)\n",
    "    if shuffle:\n",
    "        ds = ds.shuffle(buffer_size=10000)\n",
    "    ds = ds.batch(batch_size)\n",
    "    ds = ds.prefetch(tf.data.AUTOTUNE)\n",
    "    return ds"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 6,
   "id": "44b471c1",
   "metadata": {
    "execution": {
     "iopub.execute_input": "2024-08-05T01:05:35.782965Z",
     "iopub.status.busy": "2024-08-05T01:05:35.782243Z",
     "iopub.status.idle": "2024-08-05T01:05:42.687654Z",
     "shell.execute_reply": "2024-08-05T01:05:42.686611Z"
    },
    "papermill": {
     "duration": 6.913644,
     "end_time": "2024-08-05T01:05:42.689847",
     "exception": false,
     "start_time": "2024-08-05T01:05:35.776203",
     "status": "completed"
    },
    "tags": []
   },
   "outputs": [],
   "source": [
    "train_df, val_df = train_test_split(df, test_size=0.2, stratify=df.label)\n",
    "\n",
    "# Build the datasets\n",
    "train_dataset = build_dataset(\n",
    "    prompts=train_df.prompt.tolist(),\n",
    "    responses_a=train_df.response_a.tolist(),\n",
    "    responses_b=train_df.response_b.tolist(),\n",
    "    labels=train_df.label.tolist(),\n",
    "    batch_size=64,\n",
    "    shuffle=True\n",
    ")\n",
    "\n",
    "val_dataset = build_dataset(\n",
    "    prompts=val_df.prompt.tolist(),\n",
    "    responses_a=val_df.response_a.tolist(),\n",
    "    responses_b=val_df.response_b.tolist(),\n",
    "    labels=val_df.label.tolist(),\n",
    "    batch_size=64,\n",
    "    shuffle=False\n",
    ")"
   ]
  },
  {
   "cell_type": "markdown",
   "id": "228efcfe",
   "metadata": {
    "papermill": {
     "duration": 0.00477,
     "end_time": "2024-08-05T01:05:42.699934",
     "exception": false,
     "start_time": "2024-08-05T01:05:42.695164",
     "status": "completed"
    },
    "tags": []
   },
   "source": [
    "# Modeling"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 7,
   "id": "133cc07e",
   "metadata": {
    "execution": {
     "iopub.execute_input": "2024-08-05T01:05:42.711540Z",
     "iopub.status.busy": "2024-08-05T01:05:42.711221Z",
     "iopub.status.idle": "2024-08-05T01:05:47.008606Z",
     "shell.execute_reply": "2024-08-05T01:05:47.007714Z"
    },
    "papermill": {
     "duration": 4.312146,
     "end_time": "2024-08-05T01:05:47.017353",
     "exception": false,
     "start_time": "2024-08-05T01:05:42.705207",
     "status": "completed"
    },
    "tags": []
   },
   "outputs": [
    {
     "name": "stdout",
     "output_type": "stream",
     "text": [
      "INFO:tensorflow:Deallocate tpu buffers before initializing tpu system.\n"
     ]
    },
    {
     "name": "stdout",
     "output_type": "stream",
     "text": [
      "INFO:tensorflow:Initializing the TPU system: local\n"
     ]
    },
    {
     "name": "stdout",
     "output_type": "stream",
     "text": [
      "INFO:tensorflow:Finished initializing TPU system.\n"
     ]
    },
    {
     "name": "stderr",
     "output_type": "stream",
     "text": [
      "WARNING:absl:`tf.distribute.experimental.TPUStrategy` is deprecated, please use the non-experimental symbol `tf.distribute.TPUStrategy` instead.\n"
     ]
    },
    {
     "name": "stdout",
     "output_type": "stream",
     "text": [
      "INFO:tensorflow:Found TPU system:\n"
     ]
    },
    {
     "name": "stderr",
     "output_type": "stream",
     "text": [
      "INFO:tensorflow:Found TPU system:\n"
     ]
    },
    {
     "name": "stdout",
     "output_type": "stream",
     "text": [
      "INFO:tensorflow:*** Num TPU Cores: 8\n"
     ]
    },
    {
     "name": "stderr",
     "output_type": "stream",
     "text": [
      "INFO:tensorflow:*** Num TPU Cores: 8\n"
     ]
    },
    {
     "name": "stdout",
     "output_type": "stream",
     "text": [
      "INFO:tensorflow:*** Num TPU Workers: 1\n"
     ]
    },
    {
     "name": "stderr",
     "output_type": "stream",
     "text": [
      "INFO:tensorflow:*** Num TPU Workers: 1\n"
     ]
    },
    {
     "name": "stdout",
     "output_type": "stream",
     "text": [
      "INFO:tensorflow:*** Num TPU Cores Per Worker: 8\n"
     ]
    },
    {
     "name": "stderr",
     "output_type": "stream",
     "text": [
      "INFO:tensorflow:*** Num TPU Cores Per Worker: 8\n"
     ]
    },
    {
     "name": "stdout",
     "output_type": "stream",
     "text": [
      "INFO:tensorflow:*** Available Device: _DeviceAttributes(/job:localhost/replica:0/task:0/device:CPU:0, CPU, 0, 0)\n"
     ]
    },
    {
     "name": "stderr",
     "output_type": "stream",
     "text": [
      "INFO:tensorflow:*** Available Device: _DeviceAttributes(/job:localhost/replica:0/task:0/device:CPU:0, CPU, 0, 0)\n"
     ]
    },
    {
     "name": "stdout",
     "output_type": "stream",
     "text": [
      "INFO:tensorflow:*** Available Device: _DeviceAttributes(/job:localhost/replica:0/task:0/device:TPU:0, TPU, 0, 0)\n"
     ]
    },
    {
     "name": "stderr",
     "output_type": "stream",
     "text": [
      "INFO:tensorflow:*** Available Device: _DeviceAttributes(/job:localhost/replica:0/task:0/device:TPU:0, TPU, 0, 0)\n"
     ]
    },
    {
     "name": "stdout",
     "output_type": "stream",
     "text": [
      "INFO:tensorflow:*** Available Device: _DeviceAttributes(/job:localhost/replica:0/task:0/device:TPU:1, TPU, 0, 0)\n"
     ]
    },
    {
     "name": "stderr",
     "output_type": "stream",
     "text": [
      "INFO:tensorflow:*** Available Device: _DeviceAttributes(/job:localhost/replica:0/task:0/device:TPU:1, TPU, 0, 0)\n"
     ]
    },
    {
     "name": "stdout",
     "output_type": "stream",
     "text": [
      "INFO:tensorflow:*** Available Device: _DeviceAttributes(/job:localhost/replica:0/task:0/device:TPU:2, TPU, 0, 0)\n"
     ]
    },
    {
     "name": "stderr",
     "output_type": "stream",
     "text": [
      "INFO:tensorflow:*** Available Device: _DeviceAttributes(/job:localhost/replica:0/task:0/device:TPU:2, TPU, 0, 0)\n"
     ]
    },
    {
     "name": "stdout",
     "output_type": "stream",
     "text": [
      "INFO:tensorflow:*** Available Device: _DeviceAttributes(/job:localhost/replica:0/task:0/device:TPU:3, TPU, 0, 0)\n"
     ]
    },
    {
     "name": "stderr",
     "output_type": "stream",
     "text": [
      "INFO:tensorflow:*** Available Device: _DeviceAttributes(/job:localhost/replica:0/task:0/device:TPU:3, TPU, 0, 0)\n"
     ]
    },
    {
     "name": "stdout",
     "output_type": "stream",
     "text": [
      "INFO:tensorflow:*** Available Device: _DeviceAttributes(/job:localhost/replica:0/task:0/device:TPU:4, TPU, 0, 0)\n"
     ]
    },
    {
     "name": "stderr",
     "output_type": "stream",
     "text": [
      "INFO:tensorflow:*** Available Device: _DeviceAttributes(/job:localhost/replica:0/task:0/device:TPU:4, TPU, 0, 0)\n"
     ]
    },
    {
     "name": "stdout",
     "output_type": "stream",
     "text": [
      "INFO:tensorflow:*** Available Device: _DeviceAttributes(/job:localhost/replica:0/task:0/device:TPU:5, TPU, 0, 0)\n"
     ]
    },
    {
     "name": "stderr",
     "output_type": "stream",
     "text": [
      "INFO:tensorflow:*** Available Device: _DeviceAttributes(/job:localhost/replica:0/task:0/device:TPU:5, TPU, 0, 0)\n"
     ]
    },
    {
     "name": "stdout",
     "output_type": "stream",
     "text": [
      "INFO:tensorflow:*** Available Device: _DeviceAttributes(/job:localhost/replica:0/task:0/device:TPU:6, TPU, 0, 0)\n"
     ]
    },
    {
     "name": "stderr",
     "output_type": "stream",
     "text": [
      "INFO:tensorflow:*** Available Device: _DeviceAttributes(/job:localhost/replica:0/task:0/device:TPU:6, TPU, 0, 0)\n"
     ]
    },
    {
     "name": "stdout",
     "output_type": "stream",
     "text": [
      "INFO:tensorflow:*** Available Device: _DeviceAttributes(/job:localhost/replica:0/task:0/device:TPU:7, TPU, 0, 0)\n"
     ]
    },
    {
     "name": "stderr",
     "output_type": "stream",
     "text": [
      "INFO:tensorflow:*** Available Device: _DeviceAttributes(/job:localhost/replica:0/task:0/device:TPU:7, TPU, 0, 0)\n"
     ]
    },
    {
     "name": "stdout",
     "output_type": "stream",
     "text": [
      "INFO:tensorflow:*** Available Device: _DeviceAttributes(/job:localhost/replica:0/task:0/device:TPU_SYSTEM:0, TPU_SYSTEM, 0, 0)\n"
     ]
    },
    {
     "name": "stderr",
     "output_type": "stream",
     "text": [
      "INFO:tensorflow:*** Available Device: _DeviceAttributes(/job:localhost/replica:0/task:0/device:TPU_SYSTEM:0, TPU_SYSTEM, 0, 0)\n"
     ]
    }
   ],
   "source": [
    "try:\n",
    "    tpu = tf.distribute.cluster_resolver.TPUClusterResolver()\n",
    "    tf.config.experimental_connect_to_cluster(tpu)\n",
    "    tf.tpu.experimental.initialize_tpu_system(tpu)\n",
    "    tpu_strategy = tf.distribute.experimental.TPUStrategy(tpu)\n",
    "except ValueError:\n",
    "    tpu_strategy = tf.distribute.get_strategy()"
   ]
  },
  {
   "cell_type": "markdown",
   "id": "88bed5a4",
   "metadata": {
    "papermill": {
     "duration": 0.007759,
     "end_time": "2024-08-05T01:05:47.032559",
     "exception": false,
     "start_time": "2024-08-05T01:05:47.024800",
     "status": "completed"
    },
    "tags": []
   },
   "source": [
    "# Train"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 8,
   "id": "603cbc88",
   "metadata": {
    "execution": {
     "iopub.execute_input": "2024-08-05T01:05:47.053435Z",
     "iopub.status.busy": "2024-08-05T01:05:47.052957Z",
     "iopub.status.idle": "2024-08-05T01:05:56.403486Z",
     "shell.execute_reply": "2024-08-05T01:05:56.402631Z"
    },
    "papermill": {
     "duration": 9.364183,
     "end_time": "2024-08-05T01:05:56.405160",
     "exception": false,
     "start_time": "2024-08-05T01:05:47.040977",
     "status": "completed"
    },
    "tags": []
   },
   "outputs": [
    {
     "name": "stdout",
     "output_type": "stream",
     "text": [
      "Attaching 'model.safetensors' from model 'keras/bert/keras/bert_small_en_uncased/2' to your Kaggle notebook...\n"
     ]
    },
    {
     "name": "stdout",
     "output_type": "stream",
     "text": [
      "Attaching 'model.safetensors.index.json' from model 'keras/bert/keras/bert_small_en_uncased/2' to your Kaggle notebook...\n"
     ]
    },
    {
     "name": "stdout",
     "output_type": "stream",
     "text": [
      "Attaching 'metadata.json' from model 'keras/bert/keras/bert_small_en_uncased/2' to your Kaggle notebook...\n"
     ]
    },
    {
     "name": "stdout",
     "output_type": "stream",
     "text": [
      "Attaching 'metadata.json' from model 'keras/bert/keras/bert_small_en_uncased/2' to your Kaggle notebook...\n"
     ]
    },
    {
     "name": "stdout",
     "output_type": "stream",
     "text": [
      "Attaching 'config.json' from model 'keras/bert/keras/bert_small_en_uncased/2' to your Kaggle notebook...\n"
     ]
    },
    {
     "name": "stdout",
     "output_type": "stream",
     "text": [
      "Attaching 'config.json' from model 'keras/bert/keras/bert_small_en_uncased/2' to your Kaggle notebook...\n"
     ]
    },
    {
     "name": "stdout",
     "output_type": "stream",
     "text": [
      "Attaching 'model.weights.h5' from model 'keras/bert/keras/bert_small_en_uncased/2' to your Kaggle notebook...\n"
     ]
    },
    {
     "name": "stderr",
     "output_type": "stream",
     "text": [
      "I0000 00:00:1722819955.985230      77 device_compiler.h:188] Compiled cluster using XLA!  This line is logged at most once for the lifetime of the process.\n"
     ]
    },
    {
     "data": {
      "text/html": [
       "<pre style=\"white-space:pre;overflow-x:auto;line-height:normal;font-family:Menlo,'DejaVu Sans Mono',consolas,'Courier New',monospace\"><span style=\"font-weight: bold\">Model: \"functional\"</span>\n",
       "</pre>\n"
      ],
      "text/plain": [
       "\u001b[1mModel: \"functional\"\u001b[0m\n"
      ]
     },
     "metadata": {},
     "output_type": "display_data"
    },
    {
     "data": {
      "text/html": [
       "<pre style=\"white-space:pre;overflow-x:auto;line-height:normal;font-family:Menlo,'DejaVu Sans Mono',consolas,'Courier New',monospace\">┏━━━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━┳━━━━━━━━━━━━━━━━━━━┓\n",
       "┃<span style=\"font-weight: bold\"> Layer (type)        </span>┃<span style=\"font-weight: bold\"> Output Shape      </span>┃<span style=\"font-weight: bold\">    Param # </span>┃<span style=\"font-weight: bold\"> Connected to      </span>┃\n",
       "┡━━━━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━╇━━━━━━━━━━━━━━━━━━━┩\n",
       "│ prompt_padding_mask │ (<span style=\"color: #00d7ff; text-decoration-color: #00d7ff\">None</span>, <span style=\"color: #00af00; text-decoration-color: #00af00\">512</span>)       │          <span style=\"color: #00af00; text-decoration-color: #00af00\">0</span> │ -                 │\n",
       "│ (<span style=\"color: #0087ff; text-decoration-color: #0087ff\">InputLayer</span>)        │                   │            │                   │\n",
       "├─────────────────────┼───────────────────┼────────────┼───────────────────┤\n",
       "│ prompt_segment_ids  │ (<span style=\"color: #00d7ff; text-decoration-color: #00d7ff\">None</span>, <span style=\"color: #00af00; text-decoration-color: #00af00\">512</span>)       │          <span style=\"color: #00af00; text-decoration-color: #00af00\">0</span> │ -                 │\n",
       "│ (<span style=\"color: #0087ff; text-decoration-color: #0087ff\">InputLayer</span>)        │                   │            │                   │\n",
       "├─────────────────────┼───────────────────┼────────────┼───────────────────┤\n",
       "│ prompt_input        │ (<span style=\"color: #00d7ff; text-decoration-color: #00d7ff\">None</span>, <span style=\"color: #00af00; text-decoration-color: #00af00\">512</span>)       │          <span style=\"color: #00af00; text-decoration-color: #00af00\">0</span> │ -                 │\n",
       "│ (<span style=\"color: #0087ff; text-decoration-color: #0087ff\">InputLayer</span>)        │                   │            │                   │\n",
       "├─────────────────────┼───────────────────┼────────────┼───────────────────┤\n",
       "│ response_a_padding… │ (<span style=\"color: #00d7ff; text-decoration-color: #00d7ff\">None</span>, <span style=\"color: #00af00; text-decoration-color: #00af00\">512</span>)       │          <span style=\"color: #00af00; text-decoration-color: #00af00\">0</span> │ -                 │\n",
       "│ (<span style=\"color: #0087ff; text-decoration-color: #0087ff\">InputLayer</span>)        │                   │            │                   │\n",
       "├─────────────────────┼───────────────────┼────────────┼───────────────────┤\n",
       "│ response_a_segment… │ (<span style=\"color: #00d7ff; text-decoration-color: #00d7ff\">None</span>, <span style=\"color: #00af00; text-decoration-color: #00af00\">512</span>)       │          <span style=\"color: #00af00; text-decoration-color: #00af00\">0</span> │ -                 │\n",
       "│ (<span style=\"color: #0087ff; text-decoration-color: #0087ff\">InputLayer</span>)        │                   │            │                   │\n",
       "├─────────────────────┼───────────────────┼────────────┼───────────────────┤\n",
       "│ response_a_input    │ (<span style=\"color: #00d7ff; text-decoration-color: #00d7ff\">None</span>, <span style=\"color: #00af00; text-decoration-color: #00af00\">512</span>)       │          <span style=\"color: #00af00; text-decoration-color: #00af00\">0</span> │ -                 │\n",
       "│ (<span style=\"color: #0087ff; text-decoration-color: #0087ff\">InputLayer</span>)        │                   │            │                   │\n",
       "├─────────────────────┼───────────────────┼────────────┼───────────────────┤\n",
       "│ response_b_padding… │ (<span style=\"color: #00d7ff; text-decoration-color: #00d7ff\">None</span>, <span style=\"color: #00af00; text-decoration-color: #00af00\">512</span>)       │          <span style=\"color: #00af00; text-decoration-color: #00af00\">0</span> │ -                 │\n",
       "│ (<span style=\"color: #0087ff; text-decoration-color: #0087ff\">InputLayer</span>)        │                   │            │                   │\n",
       "├─────────────────────┼───────────────────┼────────────┼───────────────────┤\n",
       "│ response_b_segment… │ (<span style=\"color: #00d7ff; text-decoration-color: #00d7ff\">None</span>, <span style=\"color: #00af00; text-decoration-color: #00af00\">512</span>)       │          <span style=\"color: #00af00; text-decoration-color: #00af00\">0</span> │ -                 │\n",
       "│ (<span style=\"color: #0087ff; text-decoration-color: #0087ff\">InputLayer</span>)        │                   │            │                   │\n",
       "├─────────────────────┼───────────────────┼────────────┼───────────────────┤\n",
       "│ response_b_input    │ (<span style=\"color: #00d7ff; text-decoration-color: #00d7ff\">None</span>, <span style=\"color: #00af00; text-decoration-color: #00af00\">512</span>)       │          <span style=\"color: #00af00; text-decoration-color: #00af00\">0</span> │ -                 │\n",
       "│ (<span style=\"color: #0087ff; text-decoration-color: #0087ff\">InputLayer</span>)        │                   │            │                   │\n",
       "├─────────────────────┼───────────────────┼────────────┼───────────────────┤\n",
       "│ bert_backbone       │ [(<span style=\"color: #00d7ff; text-decoration-color: #00d7ff\">None</span>, <span style=\"color: #00af00; text-decoration-color: #00af00\">512</span>),     │ <span style=\"color: #00af00; text-decoration-color: #00af00\">28,763,648</span> │ prompt_padding_m… │\n",
       "│ (<span style=\"color: #0087ff; text-decoration-color: #0087ff\">BertBackbone</span>)      │ (<span style=\"color: #00d7ff; text-decoration-color: #00d7ff\">None</span>, <span style=\"color: #00af00; text-decoration-color: #00af00\">512</span>, <span style=\"color: #00af00; text-decoration-color: #00af00\">512</span>)] │            │ prompt_segment_i… │\n",
       "│                     │                   │            │ prompt_input[<span style=\"color: #00af00; text-decoration-color: #00af00\">0</span>][<span style=\"color: #00af00; text-decoration-color: #00af00\">…</span> │\n",
       "│                     │                   │            │ response_a_paddi… │\n",
       "│                     │                   │            │ response_a_segme… │\n",
       "│                     │                   │            │ response_a_input… │\n",
       "│                     │                   │            │ response_b_paddi… │\n",
       "│                     │                   │            │ response_b_segme… │\n",
       "│                     │                   │            │ response_b_input… │\n",
       "├─────────────────────┼───────────────────┼────────────┼───────────────────┤\n",
       "│ attention           │ (<span style=\"color: #00d7ff; text-decoration-color: #00d7ff\">None</span>, <span style=\"color: #00af00; text-decoration-color: #00af00\">512</span>, <span style=\"color: #00af00; text-decoration-color: #00af00\">512</span>)  │          <span style=\"color: #00af00; text-decoration-color: #00af00\">0</span> │ bert_backbone[<span style=\"color: #00af00; text-decoration-color: #00af00\">0</span>]… │\n",
       "│ (<span style=\"color: #0087ff; text-decoration-color: #0087ff\">Attention</span>)         │                   │            │ bert_backbone[<span style=\"color: #00af00; text-decoration-color: #00af00\">1</span>]… │\n",
       "├─────────────────────┼───────────────────┼────────────┼───────────────────┤\n",
       "│ attention_1         │ (<span style=\"color: #00d7ff; text-decoration-color: #00d7ff\">None</span>, <span style=\"color: #00af00; text-decoration-color: #00af00\">512</span>, <span style=\"color: #00af00; text-decoration-color: #00af00\">512</span>)  │          <span style=\"color: #00af00; text-decoration-color: #00af00\">0</span> │ bert_backbone[<span style=\"color: #00af00; text-decoration-color: #00af00\">0</span>]… │\n",
       "│ (<span style=\"color: #0087ff; text-decoration-color: #0087ff\">Attention</span>)         │                   │            │ bert_backbone[<span style=\"color: #00af00; text-decoration-color: #00af00\">2</span>]… │\n",
       "├─────────────────────┼───────────────────┼────────────┼───────────────────┤\n",
       "│ global_average_poo… │ (<span style=\"color: #00d7ff; text-decoration-color: #00d7ff\">None</span>, <span style=\"color: #00af00; text-decoration-color: #00af00\">512</span>)       │          <span style=\"color: #00af00; text-decoration-color: #00af00\">0</span> │ attention[<span style=\"color: #00af00; text-decoration-color: #00af00\">0</span>][<span style=\"color: #00af00; text-decoration-color: #00af00\">0</span>]   │\n",
       "│ (<span style=\"color: #0087ff; text-decoration-color: #0087ff\">GlobalAveragePool…</span> │                   │            │                   │\n",
       "├─────────────────────┼───────────────────┼────────────┼───────────────────┤\n",
       "│ global_average_poo… │ (<span style=\"color: #00d7ff; text-decoration-color: #00d7ff\">None</span>, <span style=\"color: #00af00; text-decoration-color: #00af00\">512</span>)       │          <span style=\"color: #00af00; text-decoration-color: #00af00\">0</span> │ attention_1[<span style=\"color: #00af00; text-decoration-color: #00af00\">0</span>][<span style=\"color: #00af00; text-decoration-color: #00af00\">0</span>] │\n",
       "│ (<span style=\"color: #0087ff; text-decoration-color: #0087ff\">GlobalAveragePool…</span> │                   │            │                   │\n",
       "├─────────────────────┼───────────────────┼────────────┼───────────────────┤\n",
       "│ concatenate         │ (<span style=\"color: #00d7ff; text-decoration-color: #00d7ff\">None</span>, <span style=\"color: #00af00; text-decoration-color: #00af00\">1024</span>)      │          <span style=\"color: #00af00; text-decoration-color: #00af00\">0</span> │ global_average_p… │\n",
       "│ (<span style=\"color: #0087ff; text-decoration-color: #0087ff\">Concatenate</span>)       │                   │            │ global_average_p… │\n",
       "├─────────────────────┼───────────────────┼────────────┼───────────────────┤\n",
       "│ dense (<span style=\"color: #0087ff; text-decoration-color: #0087ff\">Dense</span>)       │ (<span style=\"color: #00d7ff; text-decoration-color: #00d7ff\">None</span>, <span style=\"color: #00af00; text-decoration-color: #00af00\">32</span>)        │     <span style=\"color: #00af00; text-decoration-color: #00af00\">32,800</span> │ concatenate[<span style=\"color: #00af00; text-decoration-color: #00af00\">0</span>][<span style=\"color: #00af00; text-decoration-color: #00af00\">0</span>] │\n",
       "├─────────────────────┼───────────────────┼────────────┼───────────────────┤\n",
       "│ dropout_4 (<span style=\"color: #0087ff; text-decoration-color: #0087ff\">Dropout</span>) │ (<span style=\"color: #00d7ff; text-decoration-color: #00d7ff\">None</span>, <span style=\"color: #00af00; text-decoration-color: #00af00\">32</span>)        │          <span style=\"color: #00af00; text-decoration-color: #00af00\">0</span> │ dense[<span style=\"color: #00af00; text-decoration-color: #00af00\">0</span>][<span style=\"color: #00af00; text-decoration-color: #00af00\">0</span>]       │\n",
       "├─────────────────────┼───────────────────┼────────────┼───────────────────┤\n",
       "│ dense_1 (<span style=\"color: #0087ff; text-decoration-color: #0087ff\">Dense</span>)     │ (<span style=\"color: #00d7ff; text-decoration-color: #00d7ff\">None</span>, <span style=\"color: #00af00; text-decoration-color: #00af00\">3</span>)         │         <span style=\"color: #00af00; text-decoration-color: #00af00\">99</span> │ dropout_4[<span style=\"color: #00af00; text-decoration-color: #00af00\">0</span>][<span style=\"color: #00af00; text-decoration-color: #00af00\">0</span>]   │\n",
       "└─────────────────────┴───────────────────┴────────────┴───────────────────┘\n",
       "</pre>\n"
      ],
      "text/plain": [
       "┏━━━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━┳━━━━━━━━━━━━━━━━━━━┓\n",
       "┃\u001b[1m \u001b[0m\u001b[1mLayer (type)       \u001b[0m\u001b[1m \u001b[0m┃\u001b[1m \u001b[0m\u001b[1mOutput Shape     \u001b[0m\u001b[1m \u001b[0m┃\u001b[1m \u001b[0m\u001b[1m   Param #\u001b[0m\u001b[1m \u001b[0m┃\u001b[1m \u001b[0m\u001b[1mConnected to     \u001b[0m\u001b[1m \u001b[0m┃\n",
       "┡━━━━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━╇━━━━━━━━━━━━━━━━━━━┩\n",
       "│ prompt_padding_mask │ (\u001b[38;5;45mNone\u001b[0m, \u001b[38;5;34m512\u001b[0m)       │          \u001b[38;5;34m0\u001b[0m │ -                 │\n",
       "│ (\u001b[38;5;33mInputLayer\u001b[0m)        │                   │            │                   │\n",
       "├─────────────────────┼───────────────────┼────────────┼───────────────────┤\n",
       "│ prompt_segment_ids  │ (\u001b[38;5;45mNone\u001b[0m, \u001b[38;5;34m512\u001b[0m)       │          \u001b[38;5;34m0\u001b[0m │ -                 │\n",
       "│ (\u001b[38;5;33mInputLayer\u001b[0m)        │                   │            │                   │\n",
       "├─────────────────────┼───────────────────┼────────────┼───────────────────┤\n",
       "│ prompt_input        │ (\u001b[38;5;45mNone\u001b[0m, \u001b[38;5;34m512\u001b[0m)       │          \u001b[38;5;34m0\u001b[0m │ -                 │\n",
       "│ (\u001b[38;5;33mInputLayer\u001b[0m)        │                   │            │                   │\n",
       "├─────────────────────┼───────────────────┼────────────┼───────────────────┤\n",
       "│ response_a_padding… │ (\u001b[38;5;45mNone\u001b[0m, \u001b[38;5;34m512\u001b[0m)       │          \u001b[38;5;34m0\u001b[0m │ -                 │\n",
       "│ (\u001b[38;5;33mInputLayer\u001b[0m)        │                   │            │                   │\n",
       "├─────────────────────┼───────────────────┼────────────┼───────────────────┤\n",
       "│ response_a_segment… │ (\u001b[38;5;45mNone\u001b[0m, \u001b[38;5;34m512\u001b[0m)       │          \u001b[38;5;34m0\u001b[0m │ -                 │\n",
       "│ (\u001b[38;5;33mInputLayer\u001b[0m)        │                   │            │                   │\n",
       "├─────────────────────┼───────────────────┼────────────┼───────────────────┤\n",
       "│ response_a_input    │ (\u001b[38;5;45mNone\u001b[0m, \u001b[38;5;34m512\u001b[0m)       │          \u001b[38;5;34m0\u001b[0m │ -                 │\n",
       "│ (\u001b[38;5;33mInputLayer\u001b[0m)        │                   │            │                   │\n",
       "├─────────────────────┼───────────────────┼────────────┼───────────────────┤\n",
       "│ response_b_padding… │ (\u001b[38;5;45mNone\u001b[0m, \u001b[38;5;34m512\u001b[0m)       │          \u001b[38;5;34m0\u001b[0m │ -                 │\n",
       "│ (\u001b[38;5;33mInputLayer\u001b[0m)        │                   │            │                   │\n",
       "├─────────────────────┼───────────────────┼────────────┼───────────────────┤\n",
       "│ response_b_segment… │ (\u001b[38;5;45mNone\u001b[0m, \u001b[38;5;34m512\u001b[0m)       │          \u001b[38;5;34m0\u001b[0m │ -                 │\n",
       "│ (\u001b[38;5;33mInputLayer\u001b[0m)        │                   │            │                   │\n",
       "├─────────────────────┼───────────────────┼────────────┼───────────────────┤\n",
       "│ response_b_input    │ (\u001b[38;5;45mNone\u001b[0m, \u001b[38;5;34m512\u001b[0m)       │          \u001b[38;5;34m0\u001b[0m │ -                 │\n",
       "│ (\u001b[38;5;33mInputLayer\u001b[0m)        │                   │            │                   │\n",
       "├─────────────────────┼───────────────────┼────────────┼───────────────────┤\n",
       "│ bert_backbone       │ [(\u001b[38;5;45mNone\u001b[0m, \u001b[38;5;34m512\u001b[0m),     │ \u001b[38;5;34m28,763,648\u001b[0m │ prompt_padding_m… │\n",
       "│ (\u001b[38;5;33mBertBackbone\u001b[0m)      │ (\u001b[38;5;45mNone\u001b[0m, \u001b[38;5;34m512\u001b[0m, \u001b[38;5;34m512\u001b[0m)] │            │ prompt_segment_i… │\n",
       "│                     │                   │            │ prompt_input[\u001b[38;5;34m0\u001b[0m][\u001b[38;5;34m…\u001b[0m │\n",
       "│                     │                   │            │ response_a_paddi… │\n",
       "│                     │                   │            │ response_a_segme… │\n",
       "│                     │                   │            │ response_a_input… │\n",
       "│                     │                   │            │ response_b_paddi… │\n",
       "│                     │                   │            │ response_b_segme… │\n",
       "│                     │                   │            │ response_b_input… │\n",
       "├─────────────────────┼───────────────────┼────────────┼───────────────────┤\n",
       "│ attention           │ (\u001b[38;5;45mNone\u001b[0m, \u001b[38;5;34m512\u001b[0m, \u001b[38;5;34m512\u001b[0m)  │          \u001b[38;5;34m0\u001b[0m │ bert_backbone[\u001b[38;5;34m0\u001b[0m]… │\n",
       "│ (\u001b[38;5;33mAttention\u001b[0m)         │                   │            │ bert_backbone[\u001b[38;5;34m1\u001b[0m]… │\n",
       "├─────────────────────┼───────────────────┼────────────┼───────────────────┤\n",
       "│ attention_1         │ (\u001b[38;5;45mNone\u001b[0m, \u001b[38;5;34m512\u001b[0m, \u001b[38;5;34m512\u001b[0m)  │          \u001b[38;5;34m0\u001b[0m │ bert_backbone[\u001b[38;5;34m0\u001b[0m]… │\n",
       "│ (\u001b[38;5;33mAttention\u001b[0m)         │                   │            │ bert_backbone[\u001b[38;5;34m2\u001b[0m]… │\n",
       "├─────────────────────┼───────────────────┼────────────┼───────────────────┤\n",
       "│ global_average_poo… │ (\u001b[38;5;45mNone\u001b[0m, \u001b[38;5;34m512\u001b[0m)       │          \u001b[38;5;34m0\u001b[0m │ attention[\u001b[38;5;34m0\u001b[0m][\u001b[38;5;34m0\u001b[0m]   │\n",
       "│ (\u001b[38;5;33mGlobalAveragePool…\u001b[0m │                   │            │                   │\n",
       "├─────────────────────┼───────────────────┼────────────┼───────────────────┤\n",
       "│ global_average_poo… │ (\u001b[38;5;45mNone\u001b[0m, \u001b[38;5;34m512\u001b[0m)       │          \u001b[38;5;34m0\u001b[0m │ attention_1[\u001b[38;5;34m0\u001b[0m][\u001b[38;5;34m0\u001b[0m] │\n",
       "│ (\u001b[38;5;33mGlobalAveragePool…\u001b[0m │                   │            │                   │\n",
       "├─────────────────────┼───────────────────┼────────────┼───────────────────┤\n",
       "│ concatenate         │ (\u001b[38;5;45mNone\u001b[0m, \u001b[38;5;34m1024\u001b[0m)      │          \u001b[38;5;34m0\u001b[0m │ global_average_p… │\n",
       "│ (\u001b[38;5;33mConcatenate\u001b[0m)       │                   │            │ global_average_p… │\n",
       "├─────────────────────┼───────────────────┼────────────┼───────────────────┤\n",
       "│ dense (\u001b[38;5;33mDense\u001b[0m)       │ (\u001b[38;5;45mNone\u001b[0m, \u001b[38;5;34m32\u001b[0m)        │     \u001b[38;5;34m32,800\u001b[0m │ concatenate[\u001b[38;5;34m0\u001b[0m][\u001b[38;5;34m0\u001b[0m] │\n",
       "├─────────────────────┼───────────────────┼────────────┼───────────────────┤\n",
       "│ dropout_4 (\u001b[38;5;33mDropout\u001b[0m) │ (\u001b[38;5;45mNone\u001b[0m, \u001b[38;5;34m32\u001b[0m)        │          \u001b[38;5;34m0\u001b[0m │ dense[\u001b[38;5;34m0\u001b[0m][\u001b[38;5;34m0\u001b[0m]       │\n",
       "├─────────────────────┼───────────────────┼────────────┼───────────────────┤\n",
       "│ dense_1 (\u001b[38;5;33mDense\u001b[0m)     │ (\u001b[38;5;45mNone\u001b[0m, \u001b[38;5;34m3\u001b[0m)         │         \u001b[38;5;34m99\u001b[0m │ dropout_4[\u001b[38;5;34m0\u001b[0m][\u001b[38;5;34m0\u001b[0m]   │\n",
       "└─────────────────────┴───────────────────┴────────────┴───────────────────┘\n"
      ]
     },
     "metadata": {},
     "output_type": "display_data"
    },
    {
     "data": {
      "text/html": [
       "<pre style=\"white-space:pre;overflow-x:auto;line-height:normal;font-family:Menlo,'DejaVu Sans Mono',consolas,'Courier New',monospace\"><span style=\"font-weight: bold\"> Total params: </span><span style=\"color: #00af00; text-decoration-color: #00af00\">28,796,547</span> (109.85 MB)\n",
       "</pre>\n"
      ],
      "text/plain": [
       "\u001b[1m Total params: \u001b[0m\u001b[38;5;34m28,796,547\u001b[0m (109.85 MB)\n"
      ]
     },
     "metadata": {},
     "output_type": "display_data"
    },
    {
     "data": {
      "text/html": [
       "<pre style=\"white-space:pre;overflow-x:auto;line-height:normal;font-family:Menlo,'DejaVu Sans Mono',consolas,'Courier New',monospace\"><span style=\"font-weight: bold\"> Trainable params: </span><span style=\"color: #00af00; text-decoration-color: #00af00\">28,796,547</span> (109.85 MB)\n",
       "</pre>\n"
      ],
      "text/plain": [
       "\u001b[1m Trainable params: \u001b[0m\u001b[38;5;34m28,796,547\u001b[0m (109.85 MB)\n"
      ]
     },
     "metadata": {},
     "output_type": "display_data"
    },
    {
     "data": {
      "text/html": [
       "<pre style=\"white-space:pre;overflow-x:auto;line-height:normal;font-family:Menlo,'DejaVu Sans Mono',consolas,'Courier New',monospace\"><span style=\"font-weight: bold\"> Non-trainable params: </span><span style=\"color: #00af00; text-decoration-color: #00af00\">0</span> (0.00 B)\n",
       "</pre>\n"
      ],
      "text/plain": [
       "\u001b[1m Non-trainable params: \u001b[0m\u001b[38;5;34m0\u001b[0m (0.00 B)\n"
      ]
     },
     "metadata": {},
     "output_type": "display_data"
    }
   ],
   "source": [
    "with tpu_strategy.scope():\n",
    "    # Define input layers\n",
    "    prompt_input_ids = keras.Input(shape=(512,), dtype=tf.int32, name='prompt_input')\n",
    "    prompt_segment_ids = keras.Input(shape=(512,), dtype=tf.int32, name='prompt_segment_ids')\n",
    "    prompt_padding_mask = keras.Input(shape=(512,), dtype=tf.int32, name='prompt_padding_mask')\n",
    "\n",
    "    response_a_input_ids = keras.Input(shape=(512,), dtype=tf.int32, name='response_a_input')\n",
    "    response_a_segment_ids = keras.Input(shape=(512,), dtype=tf.int32, name='response_a_segment_ids')\n",
    "    response_a_padding_mask = keras.Input(shape=(512,), dtype=tf.int32, name='response_a_padding_mask')\n",
    "\n",
    "    response_b_input_ids = keras.Input(shape=(512,), dtype=tf.int32, name='response_b_input')\n",
    "    response_b_segment_ids = keras.Input(shape=(512,), dtype=tf.int32, name='response_b_segment_ids')\n",
    "    response_b_padding_mask = keras.Input(shape=(512,), dtype=tf.int32, name='response_b_padding_mask')\n",
    "\n",
    "    # Load BERT encoder\n",
    "    encoder = keras_nlp.models.BertBackbone.from_preset('bert_small_en_uncased')\n",
    "    encoder.trainable = True  # Allow fine-tuning\n",
    "\n",
    "    # Encode inputs\n",
    "    prompt_encoded = encoder({\n",
    "        'token_ids': prompt_input_ids,\n",
    "        'segment_ids': prompt_segment_ids,\n",
    "        'padding_mask': prompt_padding_mask\n",
    "    })['sequence_output']\n",
    "    response_a_encoded = encoder({\n",
    "        'token_ids': response_a_input_ids,\n",
    "        'segment_ids': response_a_segment_ids,\n",
    "        'padding_mask': response_a_padding_mask\n",
    "    })['sequence_output']\n",
    "    response_b_encoded = encoder({\n",
    "        'token_ids': response_b_input_ids,\n",
    "        'segment_ids': response_b_segment_ids,\n",
    "        'padding_mask': response_b_padding_mask\n",
    "    })['sequence_output']\n",
    "    \n",
    "    # Attention on prompt and response_a\n",
    "    attention_a = keras.layers.Attention()([prompt_encoded, response_a_encoded])\n",
    "    attention_a = keras.layers.GlobalAveragePooling1D()(attention_a) \n",
    "    # Attention on prompt and response_b\n",
    "    attention_b = keras.layers.Attention()([prompt_encoded, response_b_encoded])\n",
    "    attention_b = keras.layers.GlobalAveragePooling1D()(attention_b)\n",
    "\n",
    "    # Combine attentions\n",
    "    combined_attention = keras.layers.Concatenate(axis=-1)([attention_a, attention_b])\n",
    "\n",
    "    # Output layers\n",
    "    # x = keras.layers.GlobalAveragePooling1D()(combined_attention)\n",
    "    x = keras.layers.Dense(32, activation='relu')(combined_attention)\n",
    "    x = keras.layers.Dropout(0.5)(x)  # Add dropout for regularization\n",
    "    outputs = keras.layers.Dense(3, activation='softmax')(x)\n",
    "\n",
    "    # Create and compile model\n",
    "    model = keras.Model(\n",
    "        inputs=[\n",
    "            prompt_input_ids, prompt_segment_ids, prompt_padding_mask,\n",
    "            response_a_input_ids, response_a_segment_ids, response_a_padding_mask,\n",
    "            response_b_input_ids, response_b_segment_ids, response_b_padding_mask\n",
    "        ],\n",
    "        outputs=outputs\n",
    "    )\n",
    "    model.compile(\n",
    "        optimizer=keras.optimizers.Adam(learning_rate=6e-4),  # Adjusted learning rate\n",
    "        loss=keras.losses.CategoricalCrossentropy(),\n",
    "        metrics=[\"accuracy\"],\n",
    "    )\n",
    "\n",
    "    model.summary()\n"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 9,
   "id": "6695fbc3",
   "metadata": {
    "execution": {
     "iopub.execute_input": "2024-08-05T01:05:56.422005Z",
     "iopub.status.busy": "2024-08-05T01:05:56.421753Z",
     "iopub.status.idle": "2024-08-05T01:05:56.425071Z",
     "shell.execute_reply": "2024-08-05T01:05:56.424401Z"
    },
    "papermill": {
     "duration": 0.013783,
     "end_time": "2024-08-05T01:05:56.426735",
     "exception": false,
     "start_time": "2024-08-05T01:05:56.412952",
     "status": "completed"
    },
    "tags": []
   },
   "outputs": [],
   "source": [
    "# !pip install -q pydot\n",
    "# from tensorflow.keras.utils import plot_model\n",
    "\n",
    "# # Plot the model\n",
    "# plot_model(model, to_file='model_plot.png', show_shapes=True, show_layer_names=True)"
   ]
  },
  {
   "cell_type": "markdown",
   "id": "6fb0d411",
   "metadata": {
    "papermill": {
     "duration": 0.007348,
     "end_time": "2024-08-05T01:05:56.441688",
     "exception": false,
     "start_time": "2024-08-05T01:05:56.434340",
     "status": "completed"
    },
    "tags": []
   },
   "source": [
    "# Training"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 10,
   "id": "3a4ce17b",
   "metadata": {
    "execution": {
     "iopub.execute_input": "2024-08-05T01:05:56.458188Z",
     "iopub.status.busy": "2024-08-05T01:05:56.457941Z",
     "iopub.status.idle": "2024-08-05T01:18:53.695077Z",
     "shell.execute_reply": "2024-08-05T01:18:53.693637Z"
    },
    "papermill": {
     "duration": 777.249282,
     "end_time": "2024-08-05T01:18:53.698591",
     "exception": false,
     "start_time": "2024-08-05T01:05:56.449309",
     "status": "completed"
    },
    "tags": []
   },
   "outputs": [
    {
     "name": "stderr",
     "output_type": "stream",
     "text": [
      "/usr/local/lib/python3.10/site-packages/keras/src/optimizers/base_optimizer.py:664: UserWarning: Gradients do not exist for variables ['kernel', 'bias'] when minimizing the loss. If using `model.compile()`, did you forget to provide a `loss` argument?\n",
      "  warnings.warn(\n"
     ]
    },
    {
     "name": "stderr",
     "output_type": "stream",
     "text": [
      "2024-08-05 01:06:35.321444: E tensorflow/core/grappler/optimizers/meta_optimizer.cc:961] model_pruner failed: INVALID_ARGUMENT: Graph does not contain terminal node StatefulPartitionedCall.\n"
     ]
    },
    {
     "name": "stderr",
     "output_type": "stream",
     "text": [
      "I0000 00:00:1722819999.188881     842 tpu_compilation_cache_interface.cc:441] TPU host compilation cache miss: cache_key(2b29b95fbdc31c86:0:0), session_name()\n"
     ]
    },
    {
     "name": "stderr",
     "output_type": "stream",
     "text": [
      "I0000 00:00:1722820016.858163     842 tpu_compile_op_common.cc:245] Compilation of 2b29b95fbdc31c86:0:0 with session name  took 17.669238127s and succeeded\n",
      "I0000 00:00:1722820016.957594     842 tpu_compilation_cache_interface.cc:475] TPU host compilation cache: compilation complete for cache_key(2b29b95fbdc31c86:0:0), session_name(), subgraph_key(std::string(property.function_name) = \"cluster_one_step_on_iterator_13549974065549677330\", property.function_library_fingerprint = 15869973242771218355, property.mlir_module_fingerprint = 0, property.num_replicas = 8, topology.chip_bounds().x = 2, topology.chip_bounds().y = 2, topology.chip_bounds().z = 1, topology.wrap().x = false, topology.wrap().y = false, topology.wrap().z = false, std::string(property.shapes_prefix) = \"8,3,;8,512,;8,512,;8,512,;8,512,;8,512,;8,512,;8,512,;8,512,;8,512,;\", property.guaranteed_constants_size = 0, embedding_partitions_fingerprint = \"1688352644216761960\")\n",
      "I0000 00:00:1722820016.957686     842 tpu_compilation_cache_interface.cc:541] After adding entry for key 2b29b95fbdc31c86:0:0 with session_name  cache is 1 entries (194591377 bytes),  marked for eviction 0 entries (0 bytes).\n"
     ]
    },
    {
     "name": "stderr",
     "output_type": "stream",
     "text": [
      "I0000 00:00:1722820091.723175     822 tpu_compilation_cache_interface.cc:441] TPU host compilation cache miss: cache_key(d0dca13d2965e791:0:0), session_name()\n"
     ]
    },
    {
     "name": "stderr",
     "output_type": "stream",
     "text": [
      "I0000 00:00:1722820105.963158     822 tpu_compile_op_common.cc:245] Compilation of d0dca13d2965e791:0:0 with session name  took 14.239946508s and succeeded\n",
      "I0000 00:00:1722820106.039280     822 tpu_compilation_cache_interface.cc:475] TPU host compilation cache: compilation complete for cache_key(d0dca13d2965e791:0:0), session_name(), subgraph_key(std::string(property.function_name) = \"cluster_one_step_on_iterator_13549974065549677330\", property.function_library_fingerprint = 15869973242771218355, property.mlir_module_fingerprint = 0, property.num_replicas = 8, topology.chip_bounds().x = 2, topology.chip_bounds().y = 2, topology.chip_bounds().z = 1, topology.wrap().x = false, topology.wrap().y = false, topology.wrap().z = false, std::string(property.shapes_prefix) = \"4,3,;4,512,;4,512,;4,512,;4,512,;4,512,;4,512,;4,512,;4,512,;4,512,;\", property.guaranteed_constants_size = 0, embedding_partitions_fingerprint = \"1688352644216761960\")\n",
      "I0000 00:00:1722820106.039323     822 tpu_compilation_cache_interface.cc:541] After adding entry for key d0dca13d2965e791:0:0 with session_name  cache is 2 entries (371123960 bytes),  marked for eviction 0 entries (0 bytes).\n"
     ]
    },
    {
     "name": "stderr",
     "output_type": "stream",
     "text": [
      "2024-08-05 01:08:31.295688: E tensorflow/core/grappler/optimizers/meta_optimizer.cc:961] model_pruner failed: INVALID_ARGUMENT: Graph does not contain terminal node AssignVariableOp.\n"
     ]
    },
    {
     "name": "stderr",
     "output_type": "stream",
     "text": [
      "I0000 00:00:1722820112.102298     852 tpu_compilation_cache_interface.cc:441] TPU host compilation cache miss: cache_key(f31a15216694541:0:0), session_name()\n"
     ]
    },
    {
     "name": "stderr",
     "output_type": "stream",
     "text": [
      "I0000 00:00:1722820115.688439     852 tpu_compile_op_common.cc:245] Compilation of f31a15216694541:0:0 with session name  took 3.586089021s and succeeded\n",
      "I0000 00:00:1722820115.708136     852 tpu_compilation_cache_interface.cc:475] TPU host compilation cache: compilation complete for cache_key(f31a15216694541:0:0), session_name(), subgraph_key(std::string(property.function_name) = \"cluster_one_step_on_iterator_3447813239702658168\", property.function_library_fingerprint = 3685828981908808350, property.mlir_module_fingerprint = 0, property.num_replicas = 8, topology.chip_bounds().x = 2, topology.chip_bounds().y = 2, topology.chip_bounds().z = 1, topology.wrap().x = false, topology.wrap().y = false, topology.wrap().z = false, std::string(property.shapes_prefix) = \"8,3,;8,512,;8,512,;8,512,;8,512,;8,512,;8,512,;8,512,;8,512,;8,512,;\", property.guaranteed_constants_size = 0, embedding_partitions_fingerprint = \"1688352644216761960\")\n",
      "I0000 00:00:1722820115.708166     852 tpu_compilation_cache_interface.cc:541] After adding entry for key f31a15216694541:0:0 with session_name  cache is 3 entries (411268383 bytes),  marked for eviction 0 entries (0 bytes).\n"
     ]
    },
    {
     "name": "stderr",
     "output_type": "stream",
     "text": [
      "I0000 00:00:1722820122.564718     817 tpu_compilation_cache_interface.cc:441] TPU host compilation cache miss: cache_key(7392c284e424d27d:0:0), session_name()\n"
     ]
    },
    {
     "name": "stderr",
     "output_type": "stream",
     "text": [
      "I0000 00:00:1722820126.086306     817 tpu_compile_op_common.cc:245] Compilation of 7392c284e424d27d:0:0 with session name  took 3.521552501s and succeeded\n",
      "I0000 00:00:1722820126.105784     817 tpu_compilation_cache_interface.cc:475] TPU host compilation cache: compilation complete for cache_key(7392c284e424d27d:0:0), session_name(), subgraph_key(std::string(property.function_name) = \"cluster_one_step_on_iterator_3447813239702658168\", property.function_library_fingerprint = 3685828981908808350, property.mlir_module_fingerprint = 0, property.num_replicas = 8, topology.chip_bounds().x = 2, topology.chip_bounds().y = 2, topology.chip_bounds().z = 1, topology.wrap().x = false, topology.wrap().y = false, topology.wrap().z = false, std::string(property.shapes_prefix) = \"5,3,;5,512,;5,512,;5,512,;5,512,;5,512,;5,512,;5,512,;5,512,;5,512,;\", property.guaranteed_constants_size = 0, embedding_partitions_fingerprint = \"1688352644216761960\")\n",
      "I0000 00:00:1722820126.105819     817 tpu_compilation_cache_interface.cc:541] After adding entry for key 7392c284e424d27d:0:0 with session_name  cache is 4 entries (450635932 bytes),  marked for eviction 0 entries (0 bytes).\n"
     ]
    }
   ],
   "source": [
    "# Callbacks for early stopping and learning rate reduction\n",
    "early_stopping = keras.callbacks.EarlyStopping(monitor='val_loss', patience=7, restore_best_weights=True)\n",
    "reduce_lr = keras.callbacks.ReduceLROnPlateau(monitor='val_loss', factor=0.2, patience=3, min_lr=0.0)\n",
    "\n",
    "# Train the model with early stopping and learning rate reduction\n",
    "history = model.fit(train_dataset, validation_data=val_dataset, epochs=100, callbacks=[early_stopping], verbose=0)"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 11,
   "id": "da1af34c",
   "metadata": {
    "execution": {
     "iopub.execute_input": "2024-08-05T01:18:53.719947Z",
     "iopub.status.busy": "2024-08-05T01:18:53.719617Z",
     "iopub.status.idle": "2024-08-05T01:18:53.911493Z",
     "shell.execute_reply": "2024-08-05T01:18:53.910263Z"
    },
    "papermill": {
     "duration": 0.205739,
     "end_time": "2024-08-05T01:18:53.913092",
     "exception": false,
     "start_time": "2024-08-05T01:18:53.707353",
     "status": "completed"
    },
    "tags": []
   },
   "outputs": [
    {
     "data": {
      "image/png": "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",
      "text/plain": [
       "<Figure size 640x480 with 1 Axes>"
      ]
     },
     "metadata": {},
     "output_type": "display_data"
    }
   ],
   "source": [
    "# Plot the training and validation loss\n",
    "plt.plot(history.history['loss'], label='Training Loss')\n",
    "plt.plot(history.history['val_loss'], label='Validation Loss')\n",
    "plt.title('Loss over epochs')\n",
    "plt.xlabel('Epochs')\n",
    "plt.ylabel('Loss')\n",
    "plt.legend()\n",
    "plt.show()"
   ]
  },
  {
   "cell_type": "markdown",
   "id": "0e252535",
   "metadata": {
    "papermill": {
     "duration": 0.008557,
     "end_time": "2024-08-05T01:18:53.930544",
     "exception": false,
     "start_time": "2024-08-05T01:18:53.921987",
     "status": "completed"
    },
    "tags": []
   },
   "source": [
    "# Predict"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 12,
   "id": "535c8e5c",
   "metadata": {
    "execution": {
     "iopub.execute_input": "2024-08-05T01:18:53.949180Z",
     "iopub.status.busy": "2024-08-05T01:18:53.948878Z",
     "iopub.status.idle": "2024-08-05T01:18:53.967361Z",
     "shell.execute_reply": "2024-08-05T01:18:53.966509Z"
    },
    "papermill": {
     "duration": 0.029866,
     "end_time": "2024-08-05T01:18:53.969014",
     "exception": false,
     "start_time": "2024-08-05T01:18:53.939148",
     "status": "completed"
    },
    "tags": []
   },
   "outputs": [
    {
     "data": {
      "text/html": [
       "<div>\n",
       "<style scoped>\n",
       "    .dataframe tbody tr th:only-of-type {\n",
       "        vertical-align: middle;\n",
       "    }\n",
       "\n",
       "    .dataframe tbody tr th {\n",
       "        vertical-align: top;\n",
       "    }\n",
       "\n",
       "    .dataframe thead th {\n",
       "        text-align: right;\n",
       "    }\n",
       "</style>\n",
       "<table border=\"1\" class=\"dataframe\">\n",
       "  <thead>\n",
       "    <tr style=\"text-align: right;\">\n",
       "      <th></th>\n",
       "      <th>id</th>\n",
       "      <th>prompt</th>\n",
       "      <th>response_a</th>\n",
       "      <th>response_b</th>\n",
       "    </tr>\n",
       "  </thead>\n",
       "  <tbody>\n",
       "    <tr>\n",
       "      <th>0</th>\n",
       "      <td>136060</td>\n",
       "      <td>I have three oranges today, I ate an orange ye...</td>\n",
       "      <td>You have two oranges today.</td>\n",
       "      <td>You still have three oranges. Eating an orange...</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>1</th>\n",
       "      <td>211333</td>\n",
       "      <td>You are a mediator in a heated political debat...</td>\n",
       "      <td>Thank you for sharing the details of the situa...</td>\n",
       "      <td>Mr Reddy and Ms Blue both have valid points in...</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>2</th>\n",
       "      <td>1233961</td>\n",
       "      <td>How to initialize the classification head when...</td>\n",
       "      <td>When you want to initialize the classification...</td>\n",
       "      <td>To initialize the classification head when per...</td>\n",
       "    </tr>\n",
       "  </tbody>\n",
       "</table>\n",
       "</div>"
      ],
      "text/plain": [
       "        id                                             prompt  \\\n",
       "0   136060  I have three oranges today, I ate an orange ye...   \n",
       "1   211333  You are a mediator in a heated political debat...   \n",
       "2  1233961  How to initialize the classification head when...   \n",
       "\n",
       "                                          response_a  \\\n",
       "0                        You have two oranges today.   \n",
       "1  Thank you for sharing the details of the situa...   \n",
       "2  When you want to initialize the classification...   \n",
       "\n",
       "                                          response_b  \n",
       "0  You still have three oranges. Eating an orange...  \n",
       "1  Mr Reddy and Ms Blue both have valid points in...  \n",
       "2  To initialize the classification head when per...  "
      ]
     },
     "execution_count": 12,
     "metadata": {},
     "output_type": "execute_result"
    }
   ],
   "source": [
    "# Load Test Data\n",
    "test_df = pd.read_csv(base_dir + 'test.csv')\n",
    "\n",
    "# Parse String and Ensure all text data is encoded to UTF-8\n",
    "for col in [i for i in test_df.columns if i in ['prompt', 'response_a', 'response_b']]:\n",
    "    test_df[col] = test_df[col].map(lambda x: eval(x.replace(\"null\", \"''\"))[0])\n",
    "    test_df[col] = test_df[col].apply(lambda x: str(x).encode('utf-8', errors='ignore').decode('utf-8'))\n",
    "\n",
    "# Show Sample\n",
    "test_df.head()"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 13,
   "id": "5a626d78",
   "metadata": {
    "execution": {
     "iopub.execute_input": "2024-08-05T01:18:53.987949Z",
     "iopub.status.busy": "2024-08-05T01:18:53.987696Z",
     "iopub.status.idle": "2024-08-05T01:18:56.123936Z",
     "shell.execute_reply": "2024-08-05T01:18:56.122730Z"
    },
    "papermill": {
     "duration": 2.148576,
     "end_time": "2024-08-05T01:18:56.126434",
     "exception": false,
     "start_time": "2024-08-05T01:18:53.977858",
     "status": "completed"
    },
    "tags": []
   },
   "outputs": [],
   "source": [
    "# Build Test Dataset\n",
    "test_dataset = build_dataset(\n",
    "    prompts=test_df.prompt.tolist(),\n",
    "    responses_a=test_df.response_a.tolist(),\n",
    "    responses_b=test_df.response_b.tolist(),\n",
    "    labels=None,\n",
    "    batch_size=64,\n",
    "    shuffle=False\n",
    ")"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 14,
   "id": "4c9006fc",
   "metadata": {
    "execution": {
     "iopub.execute_input": "2024-08-05T01:18:56.147192Z",
     "iopub.status.busy": "2024-08-05T01:18:56.146871Z",
     "iopub.status.idle": "2024-08-05T01:19:06.229323Z",
     "shell.execute_reply": "2024-08-05T01:19:06.228079Z"
    },
    "papermill": {
     "duration": 10.094625,
     "end_time": "2024-08-05T01:19:06.231246",
     "exception": false,
     "start_time": "2024-08-05T01:18:56.136621",
     "status": "completed"
    },
    "tags": []
   },
   "outputs": [
    {
     "name": "stderr",
     "output_type": "stream",
     "text": [
      "2024-08-05 01:19:02.377662: E tensorflow/core/grappler/optimizers/meta_optimizer.cc:961] model_pruner failed: INVALID_ARGUMENT: Graph does not contain terminal node functional_1/bert_backbone_1/embeddings_layer_norm_1/Reshape/ReadVariableOp.\n"
     ]
    },
    {
     "name": "stderr",
     "output_type": "stream",
     "text": [
      "I0000 00:00:1722820742.970255     899 tpu_compilation_cache_interface.cc:441] TPU host compilation cache miss: cache_key(2c0c1945942025e7:0:0), session_name()\n"
     ]
    },
    {
     "name": "stdout",
     "output_type": "stream",
     "text": [
      "\r",
      "\u001b[1m1/1\u001b[0m \u001b[32m━━━━━━━━━━━━━━━━━━━━\u001b[0m\u001b[37m\u001b[0m \u001b[1m0s\u001b[0m 10s/step"
     ]
    },
    {
     "name": "stdout",
     "output_type": "stream",
     "text": [
      "\b\b\b\b\b\b\b\b\b\b\b\b\b\b\b\b\b\b\b\b\b\b\b\b\b\b\b\b\b\b\b\b\b\b\b\b\r",
      "\u001b[1m1/1\u001b[0m \u001b[32m━━━━━━━━━━━━━━━━━━━━\u001b[0m\u001b[37m\u001b[0m \u001b[1m10s\u001b[0m 10s/step\n"
     ]
    },
    {
     "name": "stderr",
     "output_type": "stream",
     "text": [
      "I0000 00:00:1722820746.135938     899 tpu_compile_op_common.cc:245] Compilation of 2c0c1945942025e7:0:0 with session name  took 3.165631999s and succeeded\n",
      "I0000 00:00:1722820746.158732     899 tpu_compilation_cache_interface.cc:475] TPU host compilation cache: compilation complete for cache_key(2c0c1945942025e7:0:0), session_name(), subgraph_key(std::string(property.function_name) = \"cluster_one_step_on_data_distributed_10048679654413227853\", property.function_library_fingerprint = 3856142233146699390, property.mlir_module_fingerprint = 0, property.num_replicas = 8, topology.chip_bounds().x = 2, topology.chip_bounds().y = 2, topology.chip_bounds().z = 1, topology.wrap().x = false, topology.wrap().y = false, topology.wrap().z = false, std::string(property.shapes_prefix) = \"2,512,;2,512,;2,512,;2,512,;2,512,;2,512,;2,512,;2,512,;2,512,;\", property.guaranteed_constants_size = 0, embedding_partitions_fingerprint = \"1688352644216761960\")\n",
      "I0000 00:00:1722820746.158768     899 tpu_compilation_cache_interface.cc:541] After adding entry for key 2c0c1945942025e7:0:0 with session_name  cache is 5 entries (489834173 bytes),  marked for eviction 0 entries (0 bytes).\n"
     ]
    }
   ],
   "source": [
    "test_pred = model.predict(test_dataset)"
   ]
  },
  {
   "cell_type": "markdown",
   "id": "0a341a73",
   "metadata": {
    "papermill": {
     "duration": 0.009727,
     "end_time": "2024-08-05T01:19:06.250510",
     "exception": false,
     "start_time": "2024-08-05T01:19:06.240783",
     "status": "completed"
    },
    "tags": []
   },
   "source": [
    "# Submission"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 15,
   "id": "5ee2a600",
   "metadata": {
    "execution": {
     "iopub.execute_input": "2024-08-05T01:19:06.270322Z",
     "iopub.status.busy": "2024-08-05T01:19:06.270005Z",
     "iopub.status.idle": "2024-08-05T01:19:06.285758Z",
     "shell.execute_reply": "2024-08-05T01:19:06.284765Z"
    },
    "papermill": {
     "duration": 0.028177,
     "end_time": "2024-08-05T01:19:06.287684",
     "exception": false,
     "start_time": "2024-08-05T01:19:06.259507",
     "status": "completed"
    },
    "tags": []
   },
   "outputs": [
    {
     "data": {
      "text/html": [
       "<div>\n",
       "<style scoped>\n",
       "    .dataframe tbody tr th:only-of-type {\n",
       "        vertical-align: middle;\n",
       "    }\n",
       "\n",
       "    .dataframe tbody tr th {\n",
       "        vertical-align: top;\n",
       "    }\n",
       "\n",
       "    .dataframe thead th {\n",
       "        text-align: right;\n",
       "    }\n",
       "</style>\n",
       "<table border=\"1\" class=\"dataframe\">\n",
       "  <thead>\n",
       "    <tr style=\"text-align: right;\">\n",
       "      <th></th>\n",
       "      <th>id</th>\n",
       "      <th>winner_model_a</th>\n",
       "      <th>winner_model_b</th>\n",
       "      <th>winner_tie</th>\n",
       "    </tr>\n",
       "  </thead>\n",
       "  <tbody>\n",
       "    <tr>\n",
       "      <th>0</th>\n",
       "      <td>136060</td>\n",
       "      <td>0.341386</td>\n",
       "      <td>0.341385</td>\n",
       "      <td>0.31723</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>1</th>\n",
       "      <td>211333</td>\n",
       "      <td>0.341386</td>\n",
       "      <td>0.341385</td>\n",
       "      <td>0.31723</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>2</th>\n",
       "      <td>1233961</td>\n",
       "      <td>0.341386</td>\n",
       "      <td>0.341385</td>\n",
       "      <td>0.31723</td>\n",
       "    </tr>\n",
       "  </tbody>\n",
       "</table>\n",
       "</div>"
      ],
      "text/plain": [
       "        id  winner_model_a  winner_model_b  winner_tie\n",
       "0   136060        0.341386        0.341385     0.31723\n",
       "1   211333        0.341386        0.341385     0.31723\n",
       "2  1233961        0.341386        0.341385     0.31723"
      ]
     },
     "execution_count": 15,
     "metadata": {},
     "output_type": "execute_result"
    }
   ],
   "source": [
    "submission_df = test_df[[\"id\"]].copy()\n",
    "submission_df[['winner_model_a', 'winner_model_b', 'winner_tie']] = test_pred.tolist()\n",
    "submission_df.to_csv(\"submission.csv\", index=False)\n",
    "submission_df.head()"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": null,
   "id": "0619915d",
   "metadata": {
    "papermill": {
     "duration": 0.008806,
     "end_time": "2024-08-05T01:19:06.305500",
     "exception": false,
     "start_time": "2024-08-05T01:19:06.296694",
     "status": "completed"
    },
    "tags": []
   },
   "outputs": [],
   "source": []
  }
 ],
 "metadata": {
  "kaggle": {
   "accelerator": "tpu1vmV38",
   "dataSources": [
    {
     "databundleVersionId": 8346466,
     "sourceId": 66631,
     "sourceType": "competition"
    },
    {
     "modelId": 2819,
     "modelInstanceId": 4675,
     "sourceId": 6054,
     "sourceType": "modelInstanceVersion"
    },
    {
     "modelId": 2819,
     "modelInstanceId": 4676,
     "sourceId": 6055,
     "sourceType": "modelInstanceVersion"
    },
    {
     "modelId": 2819,
     "modelInstanceId": 4678,
     "sourceId": 6057,
     "sourceType": "modelInstanceVersion"
    },
    {
     "modelId": 2819,
     "modelInstanceId": 4679,
     "sourceId": 6058,
     "sourceType": "modelInstanceVersion"
    }
   ],
   "dockerImageVersionId": 30746,
   "isGpuEnabled": false,
   "isInternetEnabled": true,
   "language": "python",
   "sourceType": "notebook"
  },
  "kernelspec": {
   "display_name": "Python 3",
   "language": "python",
   "name": "python3"
  },
  "language_info": {
   "codemirror_mode": {
    "name": "ipython",
    "version": 3
   },
   "file_extension": ".py",
   "mimetype": "text/x-python",
   "name": "python",
   "nbconvert_exporter": "python",
   "pygments_lexer": "ipython3",
   "version": "3.10.14"
  },
  "papermill": {
   "default_parameters": {},
   "duration": 854.341013,
   "end_time": "2024-08-05T01:19:12.878608",
   "environment_variables": {},
   "exception": null,
   "input_path": "__notebook__.ipynb",
   "output_path": "__notebook__.ipynb",
   "parameters": {},
   "start_time": "2024-08-05T01:04:58.537595",
   "version": "2.6.0"
  }
 },
 "nbformat": 4,
 "nbformat_minor": 5
}
